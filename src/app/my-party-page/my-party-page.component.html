<div class="my-party-page container page-container">
  <h3>{{'app.my-party'|translate}}</h3>

  <div class="party-selection container">
    <div class="party-selector row">

      <div class="party-member col-sm" *ngFor="let partyIdx of partyCnt" [ngClass]="{'in-battle': isInBattle(partyIdx)}">
        <div class="driver-title row" *ngIf="this.currentParty && this.currentParty.partyMembers[partyIdx] as partyMember" (click)="onPartyMemberClick(partyMember)">
          <div class="character-img" [attr.title]="'drivers.'+partyMember.driver.id|translate" [ngStyle]="getDriverImgStyle(partyMember)"></div>
          <h3 class="character-name">{{'drivers.'+partyMember.driver.id|translate}}</h3>
        </div>
        <div class="party-member-blades" *ngIf="this.currentParty && this.currentParty.partyMembers[partyIdx] as partyMember">
          <div class="blade-diamond">
            <div class="blade-diamond-visible">
              <div class="party-member-blade" *ngFor="let bladeIdx of bladeCnt">
                <div class="blade active-blade" *ngIf="partyMember.blades[bladeIdx] as blade" dndDropzone (dndDrop)="onBladeDropOnCharacterBladeSlot($event, partyMember, blade)"
                  (click)="onCharacterSlotBladeClick($event, partyMember, blade)" [dndDraggable]="blade.id" (dndStart)="onBladeDragStart($event, blade.id, partyMember.driver.id)">
                  <app-blade-thumbnail [blade]="blade" [showElement]="false"></app-blade-thumbnail>
                  <span class="blade-name">
                    <img class="element-img active" [src]="'assets/xc2/elements/'+blade.element+'.png'" [attr.title]="'elements.'+blade.element|translate"> {{'blades.'+blade.id|translate}}
                  </span>
                </div>
                <div class="blade free-slot" *ngIf="!partyMember.blades[bladeIdx]" dndDropzone (dndDrop)="onBladeDropOnCharacterEmptySlot($event, partyMember)">
                  <app-blade-thumbnail [blade]="undefined"></app-blade-thumbnail>
                </div>
              </div>
              <div class="party-member-blade hidden-slot" *ngIf="partyMember.hiddenBlade">
                <div class="blade">
                  <app-blade-thumbnail [blade]="partyMember.hiddenBlade"></app-blade-thumbnail>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="party-stats container">
    <div class="row" *ngIf="this.currentParty && this.currentParty.errors.length">
      <div class="col-md">
        <h3>Party issues:</h3>
        <ul>
          <li *ngFor="let e of this.currentParty.errors">
            {{e.key|translate:translateParams(e.params)}}
          </li>
        </ul>
      </div>
    </div>
    <div class="row">
      <div class="col-md" *ngIf="this.currentParty">
        <span class="stat-title">Elements: {{this.currentParty.elements.length}} / {{elements.length}}</span>
        <img class="element-img" *ngFor="let e of elements" [src]="'assets/xc2/elements/'+e+'.png'" [attr.title]="'elements.'+e|translate"
          [ngClass]="{'active':this.currentParty.elements.indexOf(e) >= 0}">
      </div>
      <div class="col-md" *ngIf="this.currentParty">
        <span class="stat-title">Driver combos: {{this.currentParty.driverCombos.length}} / {{driverCombos.length}}</span>
        <span class="driver-combo" *ngFor="let dc of driverCombos" [attr.title]="'driverCombos.'+dc|translate" [ngClass]="{'active':this.currentParty.driverCombos.indexOf(dc) >= 0}">
          {{'driverCombos.'+dc|translate}}
        </span>
      </div>
    </div>
  </div>

  <div class="blade-selection container">
    <h3>My blades</h3>
    <div class="row">
      <div class="col-sm-3 blade-item" *ngFor="let blade of usableBlades" [dndDraggable]="blade.id" (dndStart)="onBladeDragStart($event, blade.id)">
        <app-blade-thumbnail [blade]="blade" [showElement]="true" [showDriver]="true" [showRole]="true"></app-blade-thumbnail>
        <span class="blade-name">{{'blades.'+blade.id|translate}}</span>
      </div>
    </div>
  </div>
</div>
